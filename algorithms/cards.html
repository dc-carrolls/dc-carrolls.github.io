<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Flip Game</title>
    <style>
        body {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            font-family: Arial, sans-serif;
        }
        .note-area {
            width: 300px;
            height: 400px;
            border: 2px solid black;
            margin-right: 20px;
            background-color: lightgray;
            touch-action: none; /* Allows pointer events for pen or touch */
        }
        .main-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .card-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .card, .temporary {
            width: 80px;
            height: 120px;
            background-color: gray;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            border-radius: 10px;
            user-select: none;
            position: relative;
            draggable: true;
        }
        .temporary {
            background-color: lightblue;
            color: black;
            margin-top: 10px;
            margin-bottom: 20px;
        }
        .index-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .index {
            width: 80px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        .button-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <canvas class="note-area" id="noteCanvas"></canvas>
    <div class="main-content">
        <div class="index-container" id="indexes"></div>
        <div class="card-container" id="cards"></div>
        <div class="temporary" id="temporary" draggable="true">Temp</div>
        <div class="button-container">
            <button id="showButton">Show All Cards</button>
            <button id="hideButton">Hide All Cards</button>
            <button id="resetButton">Reset</button>
            <button id="clearDrawingButton">Clear Drawing</button>
        </div>
    </div>

    <script>
        const cardContainer = document.getElementById('cards');
        const tempCard = document.getElementById('temporary');
        const indexContainer = document.getElementById('indexes');
        const showButton = document.getElementById('showButton');
        const hideButton = document.getElementById('hideButton');
        const resetButton = document.getElementById('resetButton');
        const clearDrawingButton = document.getElementById('clearDrawingButton');
        const canvas = document.getElementById('noteCanvas');
        const ctx = canvas.getContext('2d');
        
        // --- NEW: variables for freehand drawing ---
        let isDrawing = false;       // Tracks whether the user is currently drawing
        let lastX = 0;              // Last X coordinate
        let lastY = 0;              // Last Y coordinate

        // Canvas setup
        canvas.width = 300;
        canvas.height = 400;
        ctx.strokeStyle = "black";
        ctx.lineWidth = 2;

        // --- NEW: Add pointer event listeners for freehand drawing ---
        canvas.addEventListener('pointerdown', (e) => {
            isDrawing = true;
            [lastX, lastY] = [e.offsetX, e.offsetY];
        });

        canvas.addEventListener('pointermove', (e) => {
            if (!isDrawing) return;
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();
            [lastX, lastY] = [e.offsetX, e.offsetY];
        });

        canvas.addEventListener('pointerup', () => {
            isDrawing = false;
        });

        canvas.addEventListener('pointerleave', () => {
            isDrawing = false;
        });
        // ------------------------------------------------------------

        let draggedCard = null;

        function createCard(value) {
            const card = document.createElement('div');
            card.classList.add('card');
            card.dataset.value = value;
            card.dataset.flipped = "false";
            card.textContent = "?";
            card.draggable = true;

            card.addEventListener('click', () => {
                if (card.dataset.flipped === "false") {
                    card.textContent = card.dataset.value;
                    card.dataset.flipped = "true";
                } else {
                    card.textContent = "?";
                    card.dataset.flipped = "false";
                }
            });

            card.addEventListener('dragstart', (e) => {
                draggedCard = card;
                e.dataTransfer.setData("text/plain", card.dataset.value);
            });

            card.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            card.addEventListener('drop', (e) => {
                e.preventDefault();
                if (draggedCard) {
                    let newValue = draggedCard.dataset ? draggedCard.dataset.value : draggedCard.textContent;
                    if (newValue && newValue !== "Temp") {
                        card.dataset.value = newValue;
                        if (card.dataset.flipped === "true") {
                            card.textContent = newValue;
                        }
                    }
                }
            });

            return card;
        }

        tempCard.addEventListener('dragstart', (e) => {
            if (tempCard.textContent !== "Temp") {
                draggedCard = tempCard;
                e.dataTransfer.setData("text/plain", tempCard.dataset.value);
            }
        });

        tempCard.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        tempCard.addEventListener('drop', (e) => {
            e.preventDefault();
            if (draggedCard) {
                let newValue = draggedCard.dataset ? draggedCard.dataset.value : draggedCard.textContent;
                if (newValue && newValue !== "Temp") {
                    tempCard.textContent = newValue;
                    tempCard.dataset.value = newValue;
                }
            }
        });

        function generateUniqueNumbers(count, min, max) {
            let numbers = new Set();
            while (numbers.size < count) {
                let num = Math.floor(Math.random() * (max - min + 1)) + min;
                numbers.add(num);
            }
            return Array.from(numbers);
        }

        function initializeCards() {
            cardContainer.innerHTML = "";
            indexContainer.innerHTML = "";
            let values = generateUniqueNumbers(6, 1, 20);
            values.forEach((value, index) => {
                let indexLabel = document.createElement('div');
                indexLabel.classList.add('index');
                indexLabel.textContent = index;
                indexContainer.appendChild(indexLabel);

                let card = createCard(value);
                cardContainer.appendChild(card);
            });
            tempCard.textContent = "Temp";
            tempCard.dataset.value = "";
        }

        showButton.addEventListener('click', () => {
            document.querySelectorAll('.card').forEach(card => {
                card.textContent = card.dataset.value;
                card.dataset.flipped = "true";
            });
        });

        hideButton.addEventListener('click', () => {
            document.querySelectorAll('.card').forEach(card => {
                card.textContent = "?";
                card.dataset.flipped = "false";
            });
        });

        resetButton.addEventListener('click', initializeCards);

        clearDrawingButton.addEventListener('click', () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });

        // Initialize the starting set of cards
        initializeCards();
    </script>
</body>
</html>
